<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>å¤©æ°—äºˆå ±</title>
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: sans-serif;
      padding: 20px;
    }
    #geoPrompt {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
      display: flex;
      justify-content: center;
      align-items: center;
      visibility: hidden;
    }
    #geoBox {
      background: #222;
      padding: 20px;
      border-radius: 10px;
      width: 260px;
      text-align: center;
    }
  </style>
</head>
<body>

<h1>å¤©æ°—äºˆå ±</h1>
<div id="weather">ä½ç½®æƒ…å ±ã®è¨±å¯ã‚’ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™ã€‚</div>

<!-- ä½ç½®æƒ…å ±è¨±å¯ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="geoPrompt">
  <div id="geoBox">
    <p>ä½ç½®æƒ…å ±ã‚’å–å¾—ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã—ã‚‡ã†ã‹ï¼Ÿ</p>
    <button id="geoYes">ã¯ã„</button>
    <button id="geoNo">ã„ã„ãˆ</button>
  </div>
</div>

<script>
  const workerURL = "https://weatherapi.xwqjix.workers.dev/";

  window.onload = () => {
    document.getElementById("geoPrompt").style.visibility = "visible";
  };

  document.getElementById("geoYes").onclick = () => {
    document.getElementById("geoPrompt").style.visibility = "hidden";
    navigator.geolocation.getCurrentPosition(success, deny);
  };

  document.getElementById("geoNo").onclick = () => {
    document.getElementById("geoPrompt").style.visibility = "hidden";
    document.getElementById("weather").innerText = "ä½ç½®æƒ…å ±ãŒæ‹’å¦ã•ã‚Œã¦ãŠã‚Šã¾ã™ã€‚";
  };

  function deny() {
    alert("ä½ç½®æƒ…å ±ã®åˆ©ç”¨ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸã®ã§ã€ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã›ã‚“ã€‚");
  }

  function success(pos) {
    const lat = pos.coords.latitude;
    const lon = pos.coords.longitude;
    fetchWeather(lat, lon);
  }

  async function fetchWeather(lat, lon) {
    document.getElementById("weather").innerText = "å–å¾—ä¸­ã§ã”ã–ã„ã¾ã™...";

    try {
      const res = await fetch(`${workerURL}?lat=${lat}&lon=${lon}`);
      const data = await res.json();

      if (data.error) {
        document.getElementById("weather").innerText = "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã„ãŸã—ã¾ã—ãŸã€‚";
        return;
      }

      const temp = data.current.temp_c;
      const text = data.current.condition.text;
      const wind = data.current.wind_kph;

      document.getElementById("weather").innerHTML = `
        <div>ğŸŒ¡ æ°—æ¸©: ${temp}Â°C</div>
        <div>â˜ å¤©æ°—: ${text}</div>
        <div>ğŸ’¨ é¢¨é€Ÿ: ${wind} km/h</div>
      `;
    } catch (e) {
      document.getElementById("weather").innerText = "é€šä¿¡ã«å•é¡ŒãŒç™ºç”Ÿã„ãŸã—ã¾ã—ãŸã€‚";
    }
  }
</script>

</body>
</html>
